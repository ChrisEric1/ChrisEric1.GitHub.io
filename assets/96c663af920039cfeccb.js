"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[64634],{164634:(e,t,n)=>{n.r(t);n.d(t,{Steps:()=>W,default:()=>q});var r=n(785893),a=n(667294),s=n(294184),i=n.n(s),o=n(441143),l=n.n(o),u=n(363010),c=n(331535),p=n(737325),E=n(952013),_=n(859169),d=n(64833),f=n(155208),m=n(916957),C=n(487502),I=n(67416),y=n(897576),M=n(932847),N=n(95467),L=n(74030),h=n(56435),T=n(212658),R=n(939042),A=n(29005),P=n(125313),b=n(112508),O=n(965952),v=n(279480),S=n(298716),g=n(461061),x=n(959797),w=n(426296),Z=n.n(w);function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){n(e);return}o.done?t(l):Promise.resolve(l).then(r,a)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){U(s,r,a,i,o,"next",e)}function o(e){U(s,r,a,i,o,"throw",e)}i(void 0)}))}}function D(e,t,n){
t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))));r.forEach((function(t){D(e,t,n[t])}))}return e}function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,s=[],i=!0,o=!1;try{for(n=n.call(e);!(i=(r=n.next()).done);i=!0){s.push(r.value);if(t&&s.length===t)break}}catch(e){o=!0;a=e}finally{try{i||null==n.return||n.return()}finally{if(o)throw a}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name)
;if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var W,H,F=function(e,t){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;(r=0,a)&&(s=[2&s[0],a.value]);switch(s[0]){case 0:case 1:a=s;break;case 4:i.label++;return{value:s[1],done:!1};case 5:i.label++;r=s[1];s=[0];continue;case 7:s=i.ops.pop();i.trys.pop();continue;default:if(!(a=i.trys,
a=a.length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1];a=s;break}if(a&&i.label<a[2]){i.label=a[2];i.ops.push(s);break}a[2]&&i.ops.pop();i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e];r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};!function(e){e[e.WHAT_YOU_LOSE=1]="WHAT_YOU_LOSE";e[e.CONFIRM=2]="CONFIRM";e[e.PREVIEW=3]="PREVIEW"}(W||(W={}));function z(e){return G.apply(this,arguments)}function G(){return(G=k((function(e){var t,n,r,a,s,i,o,l,u,c;return F(this,(function(E){switch(E.label){case 0:t=e.premiumSubscription,n=e.onClose,r=e.setHasError,a=e.setIsCancelling,s=e.analyticsLocations,i=e.analyticsLocation;E.label=1;case 1:E.trys.push([1,6,,7]);a(!0);r(!1);return t.status!==g.O0b.PAST_DUE?[3,3]:[4,(0,p.EO)(t.id,s,i)];case 2:E.sent();return[3,5];case 3:
u=null!==(l=null===(o=t.renewalMutations)||void 0===o?void 0:o.items)&&void 0!==l?l:t.items;return[4,(0,p.Mg)(t,{items:(0,L.Ue)(u)},s,i)];case 4:E.sent();E.label=5;case 5:n();null!=(c=L.ZP.getPremiumType(t.planId))&&Q({premiumType:c});return[3,7];case 6:E.sent();r(!0);a(!1);return[3,7];case 7:return[2]}}))}))).apply(this,arguments)}function K(e){var t,n=e.premiumSubscription,s=e.premiumType,i=e.setStep,o=e.onClose,l=e.whatYouLoseExperienceEnabled,u=e.analyticsLocation,p=(0,f.Q)(),_=Y(a.useState(!1),2),m=_[0],y=_[1],M=Y(a.useState(!1),2),h=M[0],T=M[1],R=(0,E.ZP)(),A=(0,d.Z)().analyticsLocations,P=null;P=n.status===g.O0b.PAST_DUE?x.Z.Messages.PREMIUM_CANCEL_PAST_DUE_CONFIRM_BODY:s===S.p9.TIER_0?p?x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_0_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:N.Z.getArticleURL(g.BhN.BLOCKED_PAYMENTS)}):x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_0.format({date:n.currentPeriodEnd
}):s===S.p9.TIER_1?p?x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_1_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:N.Z.getArticleURL(g.BhN.BLOCKED_PAYMENTS)}):x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_1.format({date:n.currentPeriodEnd}):p?x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_2_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:N.Z.getArticleURL(g.BhN.BLOCKED_PAYMENTS)}):x.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_2.format({date:n.currentPeriodEnd});var b=n.items.some((function(e){var t=e.planId;return!S.dJ.has(t)})),v=b&&null==n.renewalMutations||null!=(null===(t=n.renewalMutations)||void 0===t?void 0:t.items.find((function(e){var t=e.planId;return!S.dJ.has(t)}))),w=v?(0,r.jsx)(c.zx,{onClick:function(){return i(W.PREVIEW)},children:x.Z.Messages.NEXT}):(0,r.jsx)(c.zx,{color:c.zx.Colors.RED,disabled:m,onClick:k((function(){return F(this,(function(e){switch(e.label){case 0:return[4,z({setHasError:T,onClose:o,
premiumSubscription:n,setIsCancelling:y,analyticsLocations:A,analyticsLocation:u})];case 1:e.sent();return[2]}}))})),children:l?x.Z.Messages.CONFIRM:x.Z.Messages.PREMIUM_CANCEL_CONFIRM_NEW.format({planPremiumType:L.ZP.getDisplayPremiumType(n.planId)})}),j=(0,r.jsx)(c.zx,{look:c.zx.Looks.LINK,color:R===g.BRd.LIGHT?c.zx.Colors.PRIMARY:c.zx.Colors.WHITE,onClick:o,children:l?x.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_BACK:x.Z.Messages.CANCEL});return(0,r.jsxs)(r.Fragment,{children:[l?(0,r.jsx)(O.Z,{premiumType:s,className:Z().cancellationHeader,onClose:o}):(0,r.jsxs)(I.xB,{separator:!1,children:[(0,r.jsx)(c.vw,{tag:c.RB.H4,children:x.Z.Messages.PREMIUM_CANCEL_CONFIRM_TITLE.format({planPremiumType:L.ZP.getDisplayPremiumType(n.planId)})}),(0,r.jsx)(I.ol,{onClick:o})]}),(0,r.jsxs)(I.hz,{className:Z().body,children:[h?(0,r.jsx)(c.kz,{className:Z().errorBlock,children:x.Z.Messages.BILLING_ERROR_GENERIC}):null,(0,r.jsx)("div",{className:Z().cancelImage}),(0,r.jsx)("div",{children:P})]}),(0,
r.jsxs)(I.mz,{justify:C.Z.Justify.START,children:[w,j]})]})}function V(e){var t,n,a=e.premiumSubscription,s=Y((0,T.ED)({subscriptionId:a.id,items:(0,L.Ue)(null!==(n=null===(t=a.renewalMutations)||void 0===t?void 0:t.items)&&void 0!==n?n:a.items),renewal:!0}),1)[0],i=(0,u.e7)([m.Z],(function(){return m.Z.get(a.planId)}));if(null==s||null==i)return(0,r.jsx)(c.$j,{className:Z().loading});var o=L.ZP.getIntervalForInvoice(s),l=o.intervalType,p=o.intervalCount;return(0,r.jsxs)("div",{className:Z().bodyText,children:[(0,r.jsx)("div",{className:Z().renewalInvoiceDate,children:0!==s.total?x.Z.Messages.BILLING_SWITCH_PLAN_CHANGE_DATE_WITH_CHARGE.format({renewalDate:s.subscriptionPeriodStart,rate:(0,h.og)((0,h.T4)(s.total,s.currency),l,p)}):x.Z.Messages.BILLING_SWITCH_PLAN_CHANGE_DATE.format({renewalDate:s.subscriptionPeriodStart})}),(0,r.jsxs)(R.PO,{children:[(0,r.jsx)(R.q9,{children:x.Z.Messages.PREMIUM_SUBSCRIPTION_UPDATES}),(0,r.jsx)(R.R$,{
label:x.Z.Messages.PREMIUM_SUBSCRIPTION_CANCELLED.format({planName:L.ZP.getDisplayName(i.id)}),value:(0,L.PK)(i),className:Z().invoiceCancelRow}),(0,r.jsx)(R.KU,{}),(0,r.jsx)(b.nd,{premiumSubscription:a,renewalInvoice:s,isUpdate:!0})]})]})}function J(e){var t=e.premiumSubscription,n=e.premiumType,s=e.onBack,o=e.onClose,l=e.analyticsLocation,u=Y(a.useState(!1),2),p=u[0],E=u[1],_=Y(a.useState(!1),2),f=_[0],m=_[1],y=(0,d.Z)().analyticsLocations;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.Z,{premiumType:n,onClose:o}),(0,r.jsxs)(I.hz,{className:i()(Z().previewStep,Z().body),children:[f?(0,r.jsx)(c.kz,{className:Z().errorBlock,children:x.Z.Messages.BILLING_ERROR_GENERIC}):null,(0,r.jsx)(V,{premiumSubscription:t})]}),(0,r.jsxs)(I.mz,{align:C.Z.Align.CENTER,justify:C.Z.Justify.BETWEEN,children:[(0,r.jsx)(c.zx,{color:c.zx.Colors.RED,disabled:p,onClick:k((function(){return F(this,(function(e){switch(e.label){case 0:return[4,z({setHasError:m,onClose:o,premiumSubscription:t,
setIsCancelling:E,analyticsLocations:y,analyticsLocation:l})];case 1:e.sent();return[2]}}))})),children:x.Z.Messages.PREMIUM_CANCEL_CONFIRM_NEW.format({planPremiumType:L.ZP.getDisplayPremiumType(t.planId)})}),(0,r.jsx)(P.Z,{onClick:s})]})]})}function X(e){var t;return{subscription_id:e.id,subscription_type:e.type,subscription_plan_id:null===(t=(0,L.Af)(e))||void 0===t?void 0:t.id,subscription_plan_gateway_plan_id:e.paymentGatewayPlanId}}var $=(D(H={},W.WHAT_YOU_LOSE,"What You're Losing"),D(H,W.CONFIRM,"Confirm Cancellation"),D(H,W.PREVIEW,"Preview Updated Subscription"),H);function q(e){var t,n=e.premiumSubscription,s=e.transitionState,i=e.onClose,o=e.analyticsLocations,u=e.analyticsLocation,p=null===(t=(0,L.Af)(n))||void 0===t?void 0:t.planId,f=null!=p?L.ZP.getPremiumType(p):null;l()(null!=f,"Should not be cancelling Nitro without premiumType");var m=(0,E.ZP)();a.useEffect((function(){M.default.track(g.rMx.CANCELLATION_FLOW_STARTED,X(n))}),[n])
;var C=f===S.p9.TIER_0||f===S.p9.TIER_1||f===S.p9.TIER_2,y=C?W.WHAT_YOU_LOSE:W.CONFIRM,N=(0,d.Z)(o,_.Z.PREMIUM_SUBSCRIPTION_CANCELLATION_MODAL).AnalyticsLocationProvider,h=Y(function(e,t,n){var r=Y(a.useState(e),2),s=r[0],i=r[1],o=Y(a.useState(Date.now()),2),l=o[0],u=o[1],c=Y(a.useState(Date.now()),1)[0],p=a.useCallback((function(e){M.default.track(g.rMx.CANCELLATION_FLOW_STEP,B({from_step:$[s],to_step:$[e],step_duration_ms:Date.now()-l,flow_duration_ms:Date.now()-c,location_stack:n},X(t)));i(e);u(Date.now())}),[n,c,l,s,t]);return[s,p,l,c]}(y,n,o),4),T=h[0],R=h[1],P=h[2],b=h[3];(0,v.w)(n,i,!1);var O,w=function(e){i();M.default.track(g.rMx.CANCELLATION_FLOW_STEP,B({from_step:$[e],to_step:null,step_duration_ms:Date.now()-P,flow_duration_ms:Date.now()-b,location_stack:o},X(n)))};switch(T){case W.WHAT_YOU_LOSE:O=(0,r.jsx)(A.Z,{premiumType:f,titleText:x.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_TITLE,subtitleText:x.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_SUBTITLE.format(),footer:(0,
r.jsxs)("div",{className:Z().whatYouLoseButtonContainer,children:[(0,r.jsx)(c.zx,{onClick:function(){return R(W.CONFIRM)},children:x.Z.Messages.CONTINUE}),(0,r.jsx)(c.zx,{look:c.zx.Looks.LINK,color:m===g.BRd.DARK?c.zx.Colors.WHITE:c.zx.Colors.PRIMARY,onClick:function(){return w(T)},children:x.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_BACK})]}),onClose:function(){return w(T)}});break;case W.CONFIRM:O=(0,r.jsx)(K,{premiumSubscription:n,premiumType:f,setStep:R,onClose:function(){return w(T)},whatYouLoseExperienceEnabled:C,analyticsLocation:u});break;case W.PREVIEW:O=(0,r.jsx)(J,{premiumSubscription:n,premiumType:f,onBack:function(){return R(W.CONFIRM)},onClose:function(){return w(T)},analyticsLocation:u});break;default:throw new Error("Unexpected step: ".concat(T))}return(0,r.jsx)(N,{children:(0,r.jsx)(I.Y0,{transitionState:s,children:O})})}function Q(e){M.default.track(g.rMx.OPEN_MODAL,{type:"Nitro Churn Survey"});return(0,y.ZD)(k((function(){var t,a;return F(this,(function(s){
switch(s.label){case 0:return[4,Promise.all([n.e(40532),n.e(57656)]).then(n.bind(n,657656))];case 1:t=s.sent(),a=t.default;return[2,function(t){return(0,r.jsx)(a,B({},t,e))}]}}))})))}},125313:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(785893),a=(n(667294),n(331535)),s=n(959797),i=n(241387),o=n.n(i);const l=function(e){var t=e.onClick;return(0,r.jsx)(a.ee,{onClick:t,className:o().link,children:s.Z.Messages.BACK})}},279480:(e,t,n)=>{n.d(t,{w:()=>p,H:()=>_});var r=n(667294),a=n(363010),s=n(992497),i=n(916957),o=n(922877),l=n(74030),u=n(375650),c=n(959797);function p(e,t,n){r.useEffect((function(){if(null!=e&&e.isPurchasedExternally&&null!=e.paymentGateway&&!n){s.Z.show({title:c.Z.Messages.BILLING_EXTERNAL_HEADER.format({paymentGatewayName:u.Vz[e.paymentGateway]}),body:c.Z.Messages.BILLING_EXTERNAL_MANAGE_ELSEWHERE.format({paymentGatewayName:u.Vz[e.paymentGateway],subscriptionManagementLink:(0,l.JE)(e.paymentGateway,"SUBSCRIPTION_MANAGEMENT")}),confirmText:c.Z.Messages.OKAY});t()}}),[e])}var E=[]
;function _(e,t){var n=(0,a.e7)([i.Z],(function(){return i.Z.get(e)})),s=(0,a.e7)([o.Z],(function(){var e;return null!=n&&null!==(e=o.Z.getForSku(n.skuId))&&void 0!==e?e:E})),u=r.useMemo((function(){return Array.from(s).filter((function(e){var t=e.parentId,n=e.consumed;return null!=t&&!n}))}),[s]);return{hasEntitlements:!t&&null!=n&&null!=u&&u.length>=l.ZP.getIntervalMonths(n.interval,n.intervalCount),entitlements:u}}}}]);
//# sourceMappingURL=96c663af920039cfeccb.js.map