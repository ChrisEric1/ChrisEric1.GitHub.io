(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1518:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=a(t(98)),r=a(t(84)),c=a(t(185)),i=a(t(114)),u=a(t(19)),s=a(t(201)),d=t(1);function a(e){return e&&e.__esModule?e:{default:e}}function l(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=d.RPC_STARTING_PORT+d.RPC_PORT_RANGE-1;function R(e,n){if(null==e||null==n)throw new Error("cmd and name required");return e+":"+n}var v=c.default.parse(location.search.slice(1)),p=parseInt(v.rpc||d.RPC_STARTING_PORT,10),C=null,m=new(function(e){var n,t;function o(){return e.apply(this,arguments)||this}t=e,(n=o).prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t;var c,a,v,m=o.prototype;return m.connect=function(){var e=this;if(null==C){if(p>f)return p=d.RPC_STARTING_PORT,void this.emit("disconnected");try{C=new WebSocket("ws://127.0.0.1:"+this.port+"/?v="+d.RPC_VERSION)}catch(e){return void this.disconnect({code:d.RPCCloseCodes.CLOSE_ABNORMAL})}null!=C&&(C.onmessage=function(n){var t;try{if("string"!=typeof n.data)throw new Error("payload data not a string");t=JSON.parse(n.data)}catch(n){return e.emit("error",n),void e.disconnect()}var o=t,r=o.cmd,c=o.evt,i=o.nonce,u=o.data;if(r===d.RPCCommands.DISPATCH)return c===d.RPCEvents.READY?void e.emit("connected"):c===d.RPCEvents.ERROR?(e.emit("error",new s.default(u.code,u.message)),void e.disconnect()):void e.emit(R(r,c),u);var a=null;c===d.RPCEvents.ERROR&&(a=new s.default(u.code,u.message),u=null),e.emit(R(r,i),a,u)},C.onclose=C.onerror=function(n){return e.disconnect(n)})}},m.disconnect=function(e){if(null!=e&&"code"in e&&[d.RPCCloseCodes.CLOSE_ABNORMAL,d.RPCCloseCodes.INVALID_CLIENTID].includes(e.code))return p++,C=null,void this.connect();null!=C&&(this.emit("disconnected"),C.close(),C=null)},m.subscribe=function(e,n,t){return this.on(R(d.RPCCommands.DISPATCH,e),t),this.request(d.RPCCommands.SUBSCRIBE,n,e)},m.unsubscribe=function(e,n,t){return this.removeListener(R(d.RPCCommands.DISPATCH,e),t),this.request(d.RPCCommands.UNSUBSCRIBE,n,e)},m.request=function(e,n,t){var o=this;return new Promise((function(r,c){if(!o.connected)return o.once("connected",(function(){o.removeAllListeners("disconnected"),r(o.request(e,n,t))})),o.once("disconnected",(function(){o.removeAllListeners("connected"),c(new Error("disconnected during request"))})),void o.connect();var u=i.default.v4(),s=JSON.stringify({cmd:e,args:n,evt:t,nonce:u});o.once(R(e,u),(function(e,n){return null!=e?c(e):r(n)})),C&&C.send(s)}))},m.requestOnce=function(e,n,t){return u.default.post({url:"http://127.0.0.1:"+this.port+"/rpc?v="+d.RPC_VERSION,body:{cmd:e,args:n,evt:t,nonce:i.default.v4()}}).then((function(e){var n=e.body,t=n.evt,o=n.data;if(t===d.RPCEvents.ERROR)throw new s.default(o.code,o.message);return o}))},m.requestRedirect=function(e,n,t){if("Chrome"===r.default.name&&parseInt(r.default.version,10)>=58)return this.requestOnce(e,n,t);var o=encodeURIComponent(JSON.stringify({cmd:e,args:n,evt:t,nonce:i.default.v4()})),c=encodeURIComponent(location.protocol+"//"+location.host+location.pathname+"?done=true");return window.open("http://127.0.0.1:"+this.port+"/rpc?v="+d.RPC_VERSION+"&payload="+o+"&callback="+c,"_self"),new Promise((function(){return null}))},c=o,(a=[{key:"port",get:function(){return p}},{key:"connected",get:function(){return null!=C&&C.readyState===WebSocket.OPEN}}])&&l(c.prototype,a),v&&l(c,v),o}(o.default));n.default=m}}]);
//# sourceMappingURL=755ffca416f45dcf232e.js.map