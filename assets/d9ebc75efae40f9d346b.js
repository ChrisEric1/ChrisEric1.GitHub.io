"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[22852],{122852:(e,t,n)=>{n.r(t);n.d(t,{default:()=>O});var r=n(785893),i=n(667294),a=n(496486),o=n(331535),u=n(859169),c=n(64833),l=n(896378),s=n(546418),h=n(911016),f=n(67416),d=n(932847),p=n(204660);function y(){return n.e(5522).then(n.bind(n,305522))}var g=n(476154),A=n(461061),w=n(271606),v=n(959797),b=n(766649),m=n.n(b);function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,i)}function C(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){
return Object.getOwnPropertyDescriptor(n,e).enumerable}))));r.forEach((function(t){C(e,t,n[t])}))}return e}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done);o=!0){a.push(r.value);if(t&&a.length===t)break}}catch(e){u=!0;i=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _=function(e,t){
var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;(r=0,i)&&(a=[2&a[0],i.value]);switch(a[0]){case 0:case 1:i=a;break;case 4:o.label++;return{value:a[1],done:!1};case 5:o.label++;r=a[1];a=[0];continue;case 7:a=o.ops.pop();o.trys.pop();continue;default:if(!(i=o.trys,i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1];i=a;break}if(i&&o.label<i[2]){o.label=i[2];o.ops.push(a);break}i[2]&&o.ops.pop();o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e];r=0}finally{n=i=0}if(5&a[0])throw a[1]
;return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};const O=function(e){var t=e.file,n=e.imgURI,b=e.transitionState,x=e.allowSkip,C=void 0!==x&&x,O=e.onCrop,j=e.onClose,M=e.uploadType,N=void 0===M?g.pC.AVATAR:M,P=e.showUpsellHeader,S=void 0!==P&&P,k=e.analyticsPage,I=L(i.useState({width:0,height:0}),2),D=I[0],T=I[1],V=L(i.useState({top:0,bottom:0,left:0,right:0}),2),z=V[0],U=V[1],B=L(i.useState(!1),2),G=B[0],Z=B[1],H=L(i.useState(1),2),Y=H[0],F=H[1],K=L(i.useState({x:0,y:0}),2),X=K[0],$=K[1],q=L(i.useState(null),2),W=q[0],J=q[1],Q=L(i.useState(!1),2),ee=Q[0],te=Q[1],ne=(0,c.Z)(u.Z.IMAGE_CROPPING_MODAL).AnalyticsLocationProvider,re=(0,s.Z)().canViewThemes,ie=i.useRef({x:0,y:0}),ae=i.useRef(null),oe=i.useRef(null),ue="image/gif"===t.type;i.useEffect((function(){y()}),[]);i.useEffect((function(){ue&&S&&d.default.track(A.rMx.OPEN_MODAL,{type:A.jXE.CROP_GIF_MODAL,location:{page:k}})}),[S,k,ue]);var ce,le,se=function(){switch(N){case g.pC.BANNER:return{height:g.f,width:g.L0}
;case g.pC.BANNER_V2:return{height:g.rK,width:g.xO};case g.pC.VIDEO_BACKGROUND:return w.HE;case g.pC.AVATAR:case g.pC.AVATAR_DECORATION:return{height:A.dGM,width:A.dGM};case g.pC.GUILD_BANNER:return{height:g._T,width:g.X_};case g.pC.SCHEDULED_EVENT_IMAGE:return{height:g.xT,width:g.d6};case g.pC.HOME_HEADER:return{height:g.Uo,width:g.N8}}},he=i.useCallback((function(e,t,n){ie.current=(0,p.U$)(e,t,n);null!=ae.current&&(ae.current.style.transform="translate3d(".concat(ie.current.x,"px, ").concat(ie.current.y,"px, 0)"))}),[ae]),fe=i.useCallback((function(){if(!(null==ae.current||Y>1)){var e=ae.current.getBoundingClientRect(),t=e.width,n=e.height,r=(0,p.Es)(N,t,n),i=r.width,a=r.height,o=(0,p.AK)(N,i,a,n);J({width:i,height:a});T(o);U((0,p.kH)(i,a,o))}}),[N,Y]),de=i.useCallback((function(e){var t=ie.current,n=t.x,r=t.y;if(G&&(e.clientX!==n||e.clientY!==r)){var i=e.clientX-X.x,a=e.clientY-X.y;he(i,a,z)}}),[z,G,X,he]),pe=function(){Z(!1)},ye=(le=(ce=function(){var e,n,r,i,a,o,u
;return _(this,(function(c){switch(c.label){case 0:if(null==ae.current)return[2];te(!0);e=ae.current;n=se();if(!ue)return[3,6];c.label=1;case 1:c.trys.push([1,4,,5]);return[4,(0,p.$p)(t,e,D,ie.current,n)];case 2:i=c.sent(),a=i.result,o=i.cancelFn;oe.current=o;return[4,a];case 3:r=c.sent();oe.current=null;return[3,5];case 4:c.sent();null===(u=oe.current)||void 0===u||u.call(oe);oe.current=null;throw Error("Error cropping GIF");case 5:return[3,7];case 6:r=(0,p.PT)(e,D,ie.current,n);c.label=7;case 7:return[4,O(r,t)];case 8:c.sent();te(!1);j();return[2]}}))},function(){var e=this,t=arguments;return new Promise((function(n,r){var i=ce.apply(e,t);function a(e){E(i,n,r,a,o,"next",e)}function o(e){E(i,n,r,a,o,"throw",e)}a(void 0)}))}),function(){return le.apply(this,arguments)});i.useEffect((function(){window.addEventListener("mouseup",pe);window.addEventListener("resize",fe);return function(){window.removeEventListener("mouseup",pe);window.removeEventListener("resize",fe)}}),[fe])
;i.useEffect((function(){return function(){null!=oe.current&&oe.current()}}),[]);i.useEffect((function(){if(G){window.addEventListener("mousemove",de);return function(){return window.removeEventListener("mousemove",de)}}}),[de,G]);return(0,r.jsx)(ne,{children:(0,r.jsxs)(f.Y0,{onAnimationEnd:fe,transitionState:b,size:f.Cg.MEDIUM,children:[S&&(0,r.jsx)(l.Z,{type:N,analyticsPage:k,analyticsSection:A.jXE.CROP_GIF_MODAL,isGIF:ue,banner:n}),(0,r.jsx)(f.xB,{separator:!1,children:(0,r.jsx)(o.vw,{className:m().titleCase,tag:o.RB.H1,children:v.Z.Messages.AVATAR_UPLOAD_EDIT_MEDIA})}),(0,r.jsxs)(f.hz,{className:m().modalContent,children:[(0,r.jsxs)("div",{className:m().editingContainer,children:[(0,r.jsx)("img",{style:R({opacity:null==W?0:1,transform:"translate3d(".concat(ie.current.x,"px, ").concat(ie.current.y,"px, 0px)")},function(){if(null==W)return{};var e,t=re?g.U9:g.MY,n=W.width/W.height,r=(e=se()).width!==e.height&&n>t?D.height/W.height:1;return{width:W.width*Y*r,minWidth:W.width*Y*r,
height:W.height*Y*r}}()),className:ee?m().imageDisabled:m().imageEnabled,src:n,alt:"avatar",ref:ae,onMouseDown:function(e){var t=e.clientX-ie.current.x,n=e.clientY-ie.current.y;$({x:t,y:n});Z(!0)},draggable:!1}),(0,r.jsx)("div",{className:N===g.pC.AVATAR?m().overlayAvatar:m().overlayBanner,style:{opacity:null==W?0:1,width:D.width,height:D.height}})]}),(0,r.jsxs)("div",{className:m().sliderContainer,children:[(0,r.jsx)(h.Z,{className:m().icon,width:24,height:24}),(0,r.jsx)(o.iR,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:function(e){if(null!=W){var t=W.width,n=W.height,r=(0,p.kH)(t*e,n*e,D),i=ie.current,o=i.x,u=i.y;(0,a.inRange)(o,r.right,r.left)&&(0,a.inRange)(u,r.top,r.bottom)||he(o,u,r);F(e);U(r)}},disabled:ee,equidistant:!0,hideBubble:!0,"aria-label":v.Z.Messages.FORM_LABEL_AVATAR_SIZE}),(0,r.jsx)(h.Z,{className:m().icon,width:48,height:48})]})]}),(0,r.jsxs)(f.mz,{className:m().modalFooter,children:[C?(0,r.jsx)(o.zx,{className:m().cancelButton,
look:o.zx.Looks.LINK,color:o.zx.Colors.PRIMARY,size:o.Ph.SMALL,onClick:function(){if(C){O(n,t);j()}},children:v.Z.Messages.AVATAR_UPLOAD_SKIP}):null,(0,r.jsxs)("div",{className:m().buttonsRight,children:[(0,r.jsx)(o.zx,{className:m().cancelButton,look:o.zx.Looks.LINK,color:o.zx.Colors.PRIMARY,size:o.Ph.SMALL,onClick:function(){if(null==oe.current)j();else{oe.current();oe.current=null;te(!1)}},children:v.Z.Messages.AVATAR_UPLOAD_CANCEL}),(0,r.jsx)(o.zx,{submitting:ee,size:o.Ph.SMALL,onClick:ye,children:v.Z.Messages.AVATAR_UPLOAD_APPLY})]})]})]})})}}}]);
//# sourceMappingURL=d9ebc75efae40f9d346b.js.map