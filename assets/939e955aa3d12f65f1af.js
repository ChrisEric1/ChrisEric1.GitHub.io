"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[39810],{139810:(t,e,n)=>{n.r(e);n.d(e,{default:()=>R});var o=n(785893),r=n(667294),i=n(441143),c=n.n(i),a=n(202351),s=n(945460),l=n(875700),u=n(336334),p=n(679821),d=n(37707),f=n(396043),h=n(281808),y=n(855483),v=n(656823),b=n(30027),I=n(402008),O=n(959207),P=n(539273),g=n(476770),_=n(2590),j=n(473708),E=n(593024),S=n.n(E);function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n;return t}function m(t){m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)};return m(t)}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(t){
return Object.getOwnPropertyDescriptor(n,t).enumerable}))));o.forEach((function(e){x(t,e,n[e])}))}return t}function N(t,e){e=null!=e?e:{};Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})));n.push.apply(n,o)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}));return t}function w(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t,e){A=Object.setPrototypeOf||function(t,e){t.__proto__=e;return t};return A(t,e)}var C=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Z(t){var e=function(){
if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(t){return!1}}();return function(){var n,o=m(t);if(e){var r=m(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return w(this,n)}}var L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}});e&&A(t,e)}(n,t);var e=Z(n);function n(){T(this,n);var t;(t=e.apply(this,arguments)).state=N(M({},(0,y.H2)()),{textFocused:!0,contentWarningProps:null});t.trackInvite=function(e){if(null!=e&&e.ok){var n=t.props,o=n.activity,r=n.channel,i="";switch(n.activityActionType){case _.mFx.JOIN:i="Invite to Join";break;case _.mFx.LISTEN:i="Invite to Listen";break;case _.mFx.WATCH:
i="Invite to Watch"}f.ZP.trackWithMetadata(_.rMx.INVITE_SENT,{location:"Channel Text Area - ".concat(i),invite_type:o.type===_.IIU.LISTENING?_.dAT.SPOTIFY:_.dAT.APPLICATION,application_id:o.application_id,guild_id:r.getGuildId(),channel_id:r.id,message_id:null!=e?e.body.id:null});return Promise.resolve()}};t.handleTextChange=function(e,n,o){t.setState({textValue:n,richValue:o})};t.handleShare=function(){var e=t.props,n=e.channel,o=e.activity,r=e.activityActionType,i=e.cooldown,c=e.onClose,a=t.state,s=a.textValue,l=a.contentWarningProps;if(i>0)return Promise.resolve({shouldClear:!1,shouldRefocus:!0});var p=b.ZP.parse(n,s),d={activity:o,type:r};if(null!=l){t.setState({contentWarningProps:null});u.Z.sendMessage(n.id,p,!0,{activityAction:d}).then((function(e){return t.trackInvite(e)}));c();return Promise.resolve({shouldClear:!0,shouldRefocus:!0})}return(0,g.v)({openWarningPopout:function(e){return t.setState({contentWarningProps:e})},type:h.I.FORM,content:s,channel:n}).then((function(e){
if(!e.valid)return{shouldClear:!1,shouldRefocus:!1};u.Z.sendMessage(n.id,p,!0,{activityAction:d}).then((function(e){return t.trackInvite(e)}));c();return{shouldClear:!1,shouldRefocus:!1}}))};return t}var r=n.prototype;r.componentDidMount=function(){this.fetchApplication()};r.componentDidUpdate=function(t){this.props.activity.application_id!==t.activity.application_id&&this.fetchApplication()};r.fetchApplication=function(){var t=this.props,e=t.activity,n=t.application;null!=e.application_id&&null==n&&l.Z.fetchApplication(e.application_id)};r.renderTitle=function(){switch(this.props.activity.type){case _.IIU.LISTENING:return j.Z.Messages.INVITE_EMBED_LISTENING_INVITE;case _.IIU.PLAYING:case _.IIU.STREAMING:default:return j.Z.Messages.INVITE_EMBED_GAME_INVITE}};r.render=function(){
var t=this,e=this.state,n=e.textValue,r=e.richValue,i=e.textFocused,a=e.contentWarningProps,l=this.props,u=l.activity,f=l.analyticsLocations,y=l.channel,b=l.activityActionType,I=l.cooldown,O=l.application,P=l.transitionState,g=l.onClose,_=I>0,E=_?j.Z.Messages.CHANNEL_SLOWMODE_COOLDOWN.format({seconds:Math.round((I+1e3)/1e3)}):null;return(0,o.jsxs)(s.ModalRoot,{size:s.ModalSize.SMALL,transitionState:P,"aria-label":this.renderTitle(),children:[(0,o.jsx)(s.ModalHeader,{separator:!1,children:(0,o.jsx)(s.Heading,{variant:"heading-lg/semibold",children:this.renderTitle()})}),(0,o.jsxs)(s.ModalContent,{children:[(0,o.jsx)("div",{className:S().subHeader,children:j.Z.Messages.MESSAGE_PREVIEW}),(0,o.jsx)(p.Z,{activityActionType:b,activity:u,className:S().preview,application:O,partyId:null!=u.party?u.party.id:null,isPreview:!0,analyticsLocations:f}),(0,o.jsx)("div",{className:S().subHeader,children:j.Z.Messages.ADD_A_COMMENT_OPTIONAL}),(0,o.jsx)(s.Popout,{position:"top",onRequestClose:function(){
var e;null==a||null===(e=a.onCancel)||void 0===e||e.call(a);t.setState({contentWarningProps:null})},shouldShow:null!=a,renderPopout:function(t){var e=t.closePopout;c()(null!=a,"ActivityInvite.render - renderPopout: contentWarningProps cannot be null");return(0,o.jsx)(d.Z,M({onClose:e},a))},children:function(){return(0,o.jsx)(v.Z,{className:S().textArea,textValue:n,richValue:r,focused:i,channel:y,onChange:t.handleTextChange,onSubmit:t.handleShare,type:h.I.FORM})}})]}),(0,o.jsxs)(s.ModalFooter,{children:[(0,o.jsx)(s.Tooltip,{text:E,children:function(e){return(0,o.jsx)("div",N(M({},e),{children:(0,o.jsx)(s.Button,{disabled:_,onClick:t.handleShare,children:j.Z.Messages.INVITE_EMBED_SEND_INVITE})}))}}),(0,o.jsx)(s.Button,{look:s.Button.Looks.LINK,color:s.Button.Colors.PRIMARY,onClick:g,children:j.Z.Messages.CANCEL})]})]})};return n}(r.PureComponent);const R=a.ZP.connectStores([P.Z,O.Z],(function(t){var e=t.channel,n=t.activity;return{cooldown:P.Z.getSlowmodeCooldownGuess(e.id),
application:null!=n.application_id?O.Z.getGame(n.application_id):I.r9}}))(L)}}]);
//# sourceMappingURL=939e955aa3d12f65f1af.js.map