"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[17363],{17363:(e,t,n)=>{n.r(t);n.d(t,{default:()=>M});var r=n(785893),i=n(667294),a=n(496486),o=n(945460),u=n(153686),l=n(19585),c=n(338479),s=n(816240),h=n(652591),f=n(311260);function d(){return n.e(5522).then(n.bind(n,305522))}var p=n(921431),y=n(2590),g=n(232806),A=n(473708),b=n(428388),m=n.n(b);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t,n,r,i,a,o){try{var u=e[a](o),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,i)}function E(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){
return Object.getOwnPropertyDescriptor(n,e).enumerable}))));r.forEach((function(t){E(e,t,n[t])}))}return e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done);o=!0){a.push(r.value);if(t&&a.length===t)break}}catch(e){u=!0;i=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var L=function(e,t){
var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;(r=0,i)&&(a=[2&a[0],i.value]);switch(a[0]){case 0:case 1:i=a;break;case 4:o.label++;return{value:a[1],done:!1};case 5:o.label++;r=a[1];a=[0];continue;case 7:a=o.ops.pop();o.trys.pop();continue;default:if(!(i=o.trys,i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1];i=a;break}if(i&&o.label<i[2]){o.label=i[2];o.ops.push(a);break}i[2]&&o.ops.pop();o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e];r=0}finally{n=i=0}if(5&a[0])throw a[1]
;return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};const M=function(e){var t=e.file,n=e.imgURI,b=e.transitionState,v=e.allowSkip,E=void 0!==v&&v,M=e.onCrop,S=e.onClose,R=e.uploadType,_=void 0===R?p.pC.AVATAR:R,j=e.showUpsellHeader,O=void 0!==j&&j,k=e.analyticsPage,N=C(i.useState({width:0,height:0}),2),P=N[0],I=N[1],D=C(i.useState({top:0,bottom:0,left:0,right:0}),2),T=D[0],B=D[1],V=C(i.useState(!1),2),U=V[0],G=V[1],Z=C(i.useState(1),2),z=Z[0],F=Z[1],H=C(i.useState({x:0,y:0}),2),Y=H[0],X=H[1],K=C(i.useState(null),2),$=K[0],q=K[1],W=C(i.useState(!1),2),J=W[0],Q=W[1],ee=(0,l.Z)(u.Z.IMAGE_CROPPING_MODAL).AnalyticsLocationProvider,te=i.useRef({x:0,y:0}),ne=i.useRef(null),re=i.useRef(null),ie="image/gif"===t.type;i.useEffect((function(){d()}),[]);i.useEffect((function(){ie&&O&&h.default.track(y.rMx.OPEN_MODAL,{type:y.jXE.CROP_GIF_MODAL,location:{page:k}})}),[O,k,ie]);var ae,oe,ue=function(){switch(_){case p.pC.BANNER:return{height:p.f,width:p.L0};case p.pC.VIDEO_BACKGROUND:return g.HE
;case p.pC.AVATAR:case p.pC.AVATAR_DECORATION:return{height:y.dGM,width:y.dGM};case p.pC.GUILD_BANNER:return{height:p._T,width:p.X_};case p.pC.SCHEDULED_EVENT_IMAGE:return{height:p.xT,width:p.d6};case p.pC.HOME_HEADER:return{height:p.Uo,width:p.N8}}},le=i.useCallback((function(e,t,n){te.current=(0,f.U$)(e,t,n);null!=ne.current&&(ne.current.style.transform="translate3d(".concat(te.current.x,"px, ").concat(te.current.y,"px, 0)"))}),[ne]),ce=i.useCallback((function(){if(!(null==ne.current||z>1)){var e=ne.current.getBoundingClientRect(),t=e.width,n=e.height,r=(0,f.Es)(_,t,n),i=r.width,a=r.height,o=(0,f.AK)(_,i,a,n);q({width:i,height:a});I(o);B((0,f.kH)(i,a,o))}}),[_,z]),se=i.useCallback((function(e){var t=te.current,n=t.x,r=t.y;if(U&&(e.clientX!==n||e.clientY!==r)){var i=e.clientX-Y.x,a=e.clientY-Y.y;le(i,a,T)}}),[T,U,Y,le]),he=function(){G(!1)},fe=(oe=(ae=function(){var e,n,r,i,a,o,u;return L(this,(function(l){switch(l.label){case 0:if(null==ne.current)return[2];Q(!0);e=ne.current;n=ue()
;if(!ie)return[3,6];l.label=1;case 1:l.trys.push([1,4,,5]);return[4,(0,f.$p)(t,e,P,te.current,n)];case 2:i=l.sent(),a=i.result,o=i.cancelFn;re.current=o;return[4,a];case 3:r=l.sent();re.current=null;return[3,5];case 4:l.sent();null===(u=re.current)||void 0===u||u.call(re);re.current=null;throw Error("Error cropping GIF");case 5:return[3,7];case 6:r=(0,f.PT)(e,P,te.current,n);l.label=7;case 7:return[4,M(r,t)];case 8:l.sent();Q(!1);S();return[2]}}))},function(){var e=this,t=arguments;return new Promise((function(n,r){var i=ae.apply(e,t);function a(e){w(i,n,r,a,o,"next",e)}function o(e){w(i,n,r,a,o,"throw",e)}a(void 0)}))}),function(){return oe.apply(this,arguments)});i.useEffect((function(){window.addEventListener("mouseup",he);window.addEventListener("resize",ce);return function(){window.removeEventListener("mouseup",he);window.removeEventListener("resize",ce)}}),[ce]);i.useEffect((function(){return function(){null!=re.current&&re.current()}}),[]);i.useEffect((function(){if(U){
window.addEventListener("mousemove",se);return function(){return window.removeEventListener("mousemove",se)}}}),[se,U]);return(0,r.jsx)(ee,{children:(0,r.jsxs)(o.ModalRoot,{onAnimationEnd:ce,transitionState:b,size:o.ModalSize.MEDIUM,children:[O&&(0,r.jsx)(c.Z,{type:_,analyticsPage:k,analyticsSection:y.jXE.CROP_GIF_MODAL,isGIF:ie,banner:n}),(0,r.jsx)(o.ModalHeader,{separator:!1,children:(0,r.jsx)(o.FormTitle,{className:m().titleCase,tag:o.FormTitleTags.H1,children:A.Z.Messages.AVATAR_UPLOAD_EDIT_MEDIA})}),(0,r.jsxs)(o.ModalContent,{className:m().modalContent,children:[(0,r.jsxs)("div",{className:m().editingContainer,children:[(0,r.jsx)("img",{style:x({opacity:null==$?0:1,transform:"translate3d(".concat(te.current.x,"px, ").concat(te.current.y,"px, 0px)")},function(){if(null==$)return{};var e,t=$.width/$.height,n=(e=ue()).width!==e.height&&t>p.MY?P.height/$.height:1;return{width:$.width*z*n,minWidth:$.width*z*n,height:$.height*z*n}}()),className:J?m().imageDisabled:m().imageEnabled,
src:n,alt:"avatar",ref:ne,onMouseDown:function(e){var t=e.clientX-te.current.x,n=e.clientY-te.current.y;X({x:t,y:n});G(!0)},draggable:!1}),(0,r.jsx)("div",{className:_===p.pC.AVATAR?m().overlayAvatar:m().overlayBanner,style:{opacity:null==$?0:1,width:P.width,height:P.height}})]}),(0,r.jsxs)("div",{className:m().sliderContainer,children:[(0,r.jsx)(s.Z,{className:m().icon,width:24,height:24}),(0,r.jsx)(o.Slider,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:function(e){if(null!=$){var t=$.width,n=$.height,r=(0,f.kH)(t*e,n*e,P),i=te.current,o=i.x,u=i.y;(0,a.inRange)(o,r.right,r.left)&&(0,a.inRange)(u,r.top,r.bottom)||le(o,u,r);F(e);B(r)}},disabled:J,equidistant:!0,hideBubble:!0,"aria-label":A.Z.Messages.FORM_LABEL_AVATAR_SIZE}),(0,r.jsx)(s.Z,{className:m().icon,width:48,height:48})]})]}),(0,r.jsxs)(o.ModalFooter,{className:m().modalFooter,children:[E?(0,r.jsx)(o.Button,{className:m().cancelButton,look:o.Button.Looks.LINK,color:o.Button.Colors.PRIMARY,
size:o.ButtonSizes.SMALL,onClick:function(){if(E){M(n,t);S()}},children:A.Z.Messages.AVATAR_UPLOAD_SKIP}):null,(0,r.jsxs)("div",{className:m().buttonsRight,children:[(0,r.jsx)(o.Button,{className:m().cancelButton,look:o.Button.Looks.LINK,color:o.Button.Colors.PRIMARY,size:o.ButtonSizes.SMALL,onClick:function(){if(null==re.current)S();else{re.current();re.current=null;Q(!1)}},children:A.Z.Messages.AVATAR_UPLOAD_CANCEL}),(0,r.jsx)(o.Button,{submitting:J,size:o.ButtonSizes.SMALL,onClick:fe,children:A.Z.Messages.AVATAR_UPLOAD_APPLY})]})]})]})})}}}]);
//# sourceMappingURL=6d547596f1e0c872d042.js.map